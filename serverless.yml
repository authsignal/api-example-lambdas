service: api-example

provider:
  name: aws
  runtime: nodejs20.x
  environment:
    AUTHSIGNAL_SECRET: ${env:AUTHSIGNAL_SECRET}
    AUTHSIGNAL_URL: ${env:AUTHSIGNAL_URL}
    AUTHSIGNAL_TENANT: ${env:AUTHSIGNAL_TENANT}
    AUTHSIGNAL_CLIENT: ${env:AUTHSIGNAL_CLIENT}
  httpApi:
    authorizers:
      jwtAuthorizer:
        type: jwt
        identitySource: $request.header.authorization
        issuerUrl: ${env:AUTHSIGNAL_URL}/client/public/${env:AUTHSIGNAL_TENANT}
        audience:
          - ${env:AUTHSIGNAL_CLIENT}

package:
  individually: true

functions:
  initEmailSignIn:
    handler: api/init-email-sign-in.handler
    events:
      - httpApi:
          method: post
          path: /sign-in/email

  signIn:
    handler: api/sign-in.handler
    events:
      - httpApi:
          method: post
          path: /sign-in

  signOut:
    handler: api/sign-out.handler
    events:
      - httpApi:
          method: post
          path: /sign-out

  refreshSession:
    handler: api/refresh-session.handler
    events:
      - httpApi:
          method: post
          path: /sign-in/refresh

  initPasskeyRegistration:
    handler: api/init-passkey-registration.handler
    events:
      - httpApi:
          method: post
          path: /register/passkey
          authorizer:
            name: jwtAuthorizer

  initPushRegistration:
    handler: api/init-push-registration.handler
    events:
      - httpApi:
          method: post
          path: /register/push
          authorizer:
            name: jwtAuthorizer

  userProfile:
    handler: api/user-profile.handler
    events:
      - httpApi:
          method: get
          path: /profile
          authorizer:
            name: jwtAuthorizer
